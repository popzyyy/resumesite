{% extends 'main.html' %}
{% load static %}
{% block content %}
    <style>
        .formset-container {
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 20px;
        }

        .textarea {
            width: 100%;
            height: 15em;
            margin: 2px;
            padding: 2em;
            border: 0;
        }

        #id_text {
            outline: 3px solid black;
            width: 100%;
            height: 100%;
        }
    </style>

    <div id="banner-wrapper">
        <div id="banner" class="box container">
            {% if not time_db %}
                <h2>Find Out. Memento Mori</h2>
            {% endif %}
            <div class="row">
                <div class="col-12">
                    {% if time_db %}
                        <h3>Exact Time of Death</h3>
                        <div style="padding-bottom: 2em;">
                            <b><p style="font-size: 1.5em;">{{ time_db }}</p></b>
                        </div>
                        <h3>Time's Ticking Buddy...... You're Cooked</h3>
                        <b>
                            <div id="countdown" style="font-size: 2em;"></div>
                        </b>
                    {% endif %}

                    <form id="form-container" class="row" method="POST">
                        {% csrf_token %}
                        {% if not time_db %}
                            <div class="row">
                            <div style="padding-top: 4em; display: inline-block;">
                                <button class="button" type="submit">Find Out</button>
                            </div>
                        {% endif %}
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <script>
        const dbTime = new Date("{{ time_db }}");

        function updateCountdown() {
            const now = new Date();
            const diff = dbTime - now;

            if (diff <= 0) {
                document.getElementById("countdown").innerText = "Time's up.";
                clearInterval(timer);
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);

            document.getElementById("countdown").innerText =
                `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        updateCountdown();
        const timer = setInterval(updateCountdown, 1000);
    </script>
{% endblock %}